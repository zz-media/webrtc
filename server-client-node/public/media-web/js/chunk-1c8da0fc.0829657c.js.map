{"version":3,"sources":["webpack:///./src/views/RelayPage.vue","webpack:///./src/components/webrtc/RemoteRelayDes.vue","webpack:///src/components/webrtc/RemoteRelayDes.vue","webpack:///./src/components/webrtc/RemoteRelayDes.vue?ee7a","webpack:///./src/components/webrtc/RemoteRelayDes.vue?50a0","webpack:///src/views/RelayPage.vue","webpack:///./src/views/RelayPage.vue?87a8","webpack:///./src/views/RelayPage.vue?284d","webpack:///./src/components/webrtc/RemoteRelayDes.vue?81e8"],"names":["render","_vm","this","_c","_self","staticClass","attrs","on","start","_v","directives","name","rawName","value","wsUrl","expression","domProps","$event","target","composing","roomId","ref","staticRenderFns","staticStyle","props","data","pcConfig","socket","pc","pcDesSessionMap","srcSocketId","remoteStream","methods","console","peer","then","catch","sdpMLineIndex","candidate","createPeerConnection","type","label","id","createPeerConnectionMysrc","offerToRecieveAudio","offerToRecieveVideo","getRemoteStream","getAnswer","handleAnswerError","handleOfferError","sendMessage","sendMessageDes","component","components","RemoteRelayDes","msg","mounted"],"mappings":"yHAAA,IAAIA,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACE,YAAY,mBAAmB,CAACF,EAAG,MAAM,CAACA,EAAG,SAAS,CAACG,MAAM,CAAC,GAAK,cAAcC,GAAG,CAAC,MAAQN,EAAIO,QAAQ,CAACP,EAAIQ,GAAG,QAAQN,EAAG,SAAS,CAACG,MAAM,CAAC,GAAK,QAAQ,SAAW,KAAK,CAACL,EAAIQ,GAAG,QAAQR,EAAIQ,GAAG,cAAcN,EAAG,QAAQ,CAACO,WAAW,CAAC,CAACC,KAAK,QAAQC,QAAQ,UAAUC,MAAOZ,EAAIa,MAAOC,WAAW,UAAUT,MAAM,CAAC,GAAK,cAAcU,SAAS,CAAC,MAASf,EAAIa,OAAQP,GAAG,CAAC,MAAQ,SAASU,GAAWA,EAAOC,OAAOC,YAAiBlB,EAAIa,MAAMG,EAAOC,OAAOL,WAAUZ,EAAIQ,GAAG,cAAcN,EAAG,QAAQ,CAACO,WAAW,CAAC,CAACC,KAAK,QAAQC,QAAQ,UAAUC,MAAOZ,EAAImB,OAAQL,WAAW,WAAWT,MAAM,CAAC,GAAK,UAAUU,SAAS,CAAC,MAASf,EAAImB,QAASb,GAAG,CAAC,MAAQ,SAASU,GAAWA,EAAOC,OAAOC,YAAiBlB,EAAImB,OAAOH,EAAOC,OAAOL,WAAUZ,EAAIQ,GAAG,eAAeN,EAAG,QAAQ,CAACG,MAAM,CAAC,KAAO,WAAW,GAAK,cAAcL,EAAIQ,GAAG,iCAAiCN,EAAG,mBAAmB,CAACkB,IAAI,iBAAiBf,MAAM,CAAC,MAAQL,EAAIa,MAAM,OAASb,EAAImB,WAAW,IAEl/BE,EAAkB,GCFlBtB,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACE,YAAY,SAAS,CAACF,EAAG,MAAM,CAACA,EAAG,OAAO,CAACF,EAAIQ,GAAG,cAAcN,EAAG,QAAQ,CAACkB,IAAI,cAAcE,YAAY,CAAC,OAAS,QAAQ,MAAQ,QAAQ,mBAAmB,YAAY,aAAa,QAAQjB,MAAM,CAAC,GAAK,cAAc,SAAW,GAAG,YAAc,WAE/TgB,EAAkB,G,qBCYP,GACfE,SAGAC,OACA,OACAX,6BACAM,oBACAM,UAAA,6JACAC,YACAC,QACAC,wBACAC,iBACAC,oBAGAC,SACAxB,SACAyB,uBACA,mBACA,qBACA,yBAEA,oCACAA,yBACA,oCACAA,+CACA,8BAGA,kCACAA,6CACA,gBACA,oCAQA,6BAMA,GALAA,oCAEA,sBACAR,iBAEA,sBAKA,WACA,2CAQA,GAPA,SACAS,UACA,iCAEAA,SAGA,iBAEA,2DACA,uBACAC,qBACAC,mCACA,oBACAF,0DAEA,yBACA,2BACAG,sBACAC,wBAEAJ,0BAGAD,gDA9BAA,2CAkCA,yCACA,8CAEAM,uBACAN,yCACA,6CACA,kBACA,2BACA,YACA,oBACAO,iBACAC,gCACAC,sBACAJ,kCAGAL,0CAGA,sCAGAU,6BACA,WACAV,4CACA,kCACA,OA4BA,GA3BA,EAsBAA,4CAfAC,uCACA,qCACAA,qBACA,YACA,uCACAM,iBACAC,gCACAC,sBACAJ,kCAGAL,2CASA,qBAKA,yDAKA,0CACAC,+BAEAD,2DAEAA,mCAGA,OACAW,sBACAC,uBAIAX,iBACAC,SACAD,yBAIA,2CAGAE,kCA3BAH,yDALAA,2CAmCAa,mBACAb,8BACA,+BACA,oDAEAc,aACAd,mCACA,+BAGA,iCAEAe,qBACAf,6CAEAgB,oBACAhB,4CAEAiB,iBACA,gBAIAjB,2BACA,6CACAA,yCACA,iCANAA,+BAQAkB,sBACAlB,6CACA,YAIA,kDAHAA,iCCzNuW,I,wBCQnWmB,EAAY,eACd,EACA,EACA,GACA,EACA,KACA,WACA,MAIa,EAAAA,E,QCFA,GACfC,YACAC,kBAEA3C,uBACAa,OACA+B,YAEA9B,OACA,OACAX,6BACAM,oBACAM,UAAA,+JAGA8B,qBAGAxB,SACAxB,QACA,OACAM,iBACAM,mBACAM,wBAGA,sCC3CmV,ICO/U,EAAY,eACd,EACA1B,EACAsB,GACA,EACA,KACA,WACA,MAIa,e,sEClBf","file":"js/chunk-1c8da0fc.0829657c.js","sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"supervisionList\"},[_c('div',[_c('button',{attrs:{\"id\":\"connserver\"},on:{\"click\":_vm.start}},[_vm._v(\"启动\")]),_c('button',{attrs:{\"id\":\"leave\",\"disabled\":\"\"}},[_vm._v(\"关闭\")]),_vm._v(\" socket地址：\"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.wsUrl),expression:\"wsUrl\"}],attrs:{\"id\":\"socketHost\"},domProps:{\"value\":(_vm.wsUrl)},on:{\"input\":function($event){if($event.target.composing)return;_vm.wsUrl=$event.target.value}}}),_vm._v(\" socket房间：\"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.roomId),expression:\"roomId\"}],attrs:{\"id\":\"roomId\"},domProps:{\"value\":(_vm.roomId)},on:{\"input\":function($event){if($event.target.composing)return;_vm.roomId=$event.target.value}}}),_vm._v(\" 强制使用中继服务器:\"),_c('input',{attrs:{\"type\":\"checkbox\",\"id\":\"useRelay\"}}),_vm._v(\"chrome://webrtc-internals/ \")]),_c('remote-relay-des',{ref:\"RemoteRelayDes\",attrs:{\"wsUrl\":_vm.wsUrl,\"roomId\":_vm.roomId}})],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"hello\"},[_c('div',[_c('span',[_vm._v(\"relay画面:\")]),_c('video',{ref:\"remoteVideo\",staticStyle:{\"height\":\"360px\",\"width\":\"640px\",\"background-color\":\"gainsboro\",\"object-fit\":\"fill\"},attrs:{\"id\":\"remotevideo\",\"autoplay\":\"\",\"playsinline\":\"\"}})])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"hello\">\n    <div>\n        <span>relay画面:</span>\n        <!-- <video id=\"remote-video\" style=\"max-height:400px;background-color:gainsboro;\"  autoplay></video> -->\n        <!-- <video id=\"remote-video\" style=\"height:840;width:1600;background-color:gainsboro;\"  autoplay></video> -->\n        <video ref=\"remoteVideo\" id=\"remotevideo\" style=\"height:360px;width:640px;background-color:gainsboro;object-fit:fill;\" autoplay playsinline></video>\n    </div>\n  </div>\n</template>\n\n<script>\nimport io from 'socket.io-client';\n\nexport default {\n  props: {\n\n  },\n  data() {\n    return {\n      wsUrl: \"wss://localhost:8843\",\n      roomId: \"room-multi\",\n      pcConfig: {\"iceServers\":[{\"urls\":[\"stun:stun.l.google.com:19302\"]},{\"urls\":[\"turn:rtctest.zdomain.top:3478\"],\"username\":\"admin\",\"credential\":\"123456\"}],\"iceTransportPolicy\":\"all\"},\n      socket: null,\n      pc: null,\n      pcDesSessionMap: new Map(),\n      srcSocketId: null,\n      remoteStream: null,\n    };\n  },\n  methods: {\n    start(config) {\n      console.log(\"start\",config);\n      this.wsUrl=config.wsUrl;\n      this.roomId=config.roomId;\n      this.pcConfig=config.pcConfig;\n\n      this.socket = io.connect(this.wsUrl);\n      console.log(this.socket);\n      this.socket.on('des-joined', (roomid, id) => {\n        console.log('receive des-joined message!', roomid, id);\n        this.createPeerConnection();\n      });\n\n      this.socket.on('des-join', (roomid,desDocketId) => {\n        console.log('receive des-join message:', roomid, desDocketId);\n        if(this.roomId!=roomid){//\n          this.createPeerConnectionMysrc(desDocketId);\n        }\n        \n\n        // call(desDocketId);\t\n        // console.log('receive des-join message, desDocketId=', desDocketId);\n      });\n      \n      this.socket.on('msg', (header,data) => {\n        console.log('receive message!', header, data);\n\n        if(typeof data === 'string'){\n          data = JSON.parse(data);\n        }\n        if(data === null || data === undefined){\n          console.error('the message is invalid!');\n          return;\t\n        }\n\n        var peer = null;\n        var sessionInfo = this.pcDesSessionMap.get(header.fromSocketId);\n        if(sessionInfo==null){\n          peer = this.pc;\n          this.srcSocketId = header.fromSocketId;\n        }else{\n          peer = sessionInfo.peer;\n        }\n\n        if(data.type === 'offer') {//data.hasOwnProperty('type') && \n          \n          this.pc.setRemoteDescription(new RTCSessionDescription(data));\n          this.pc.createAnswer()\n            .then(this.getAnswer)\n            .catch(this.handleAnswerError);\n        }else if(data.type == 'answer'){\n\t\t\t    peer.setRemoteDescription(new RTCSessionDescription(data));\n\t\t\n        }else if (data.type === 'candidate'){//data.hasOwnProperty('type') && \n          var candidate = new RTCIceCandidate({\n            sdpMLineIndex: data.label,\n            candidate: data.candidate\n          });\n          peer.addIceCandidate(candidate);\t\n        \n        }else{\n          console.log('the message is invalid!!!', data);\n        }\n      });\n\n      this.socket.emit('des-join', this.roomId);\n      this.socket.emit('src-join', this.roomId+\"2\");\n    },\n    createPeerConnection() {\n      console.log('create RTCPeerConnection!');\n      this.pc = new RTCPeerConnection(this.pcConfig);\n      var roomIdThat = this.roomId;\n      this.pc.onicecandidate = (e)=>{\n        if(e.candidate) {\n          this.sendMessage(roomIdThat, {\n            type: 'candidate',\n            label:e.candidate.sdpMLineIndex, \n            id:e.candidate.sdpMid, \n            candidate: e.candidate.candidate\n          });\n        }else{\n          console.log('this is the end candidate');\n        }\n      }\n      this.pc.ontrack = this.getRemoteStream;\n\n    },\n    createPeerConnectionMysrc(desSocketId){\n      var vm = this;\n      console.log('create RTCPeerConnection! '+desSocketId);\n      var sessionInfo = this.pcDesSessionMap.get(desSocketId);\n      var peer = null;\n      if(!sessionInfo){\n        // if(document.querySelector('#useRelay').checked){\n        //   pcConfig.iceTransportPolicy=\"relay\";\n        // }else{\n        //   pcConfig.iceTransportPolicy=\"all\";\n        // }\n        //console.log(\"pcConfig\",pcConfig);\t\t\n        peer = new RTCPeerConnection(this.pcConfig);\n        this.pcDesSessionMap.set(desSocketId,{\"peer\":peer});\n        peer.onicecandidate = (e)=>{\n          if(e.candidate) {\n            this.sendMessageDes(this.roomId+\"2\",desSocketId, {\n              type: 'candidate',\n              label:e.candidate.sdpMLineIndex, \n              id:e.candidate.sdpMid, \n              candidate: e.candidate.candidate\n            });\n          }else{\n            console.log('this is the end candidate');\n          }\n        }\t\t\n      }else {\n        console.warning('the pc have be created!');\n      }\n\n      \n\n      if(peer === null || peer === undefined) {\n        console.error('pc is null or undefined!');\n        return;\n      }\n\n      if(this.remoteStream === null || this.remoteStream === undefined) {\n        console.error('remoteStream is null or undefined!');\n        return;\n      }\n      //add all track into peer connection\n      this.remoteStream.getTracks().forEach((track)=>{\n        peer.addTrack(track, vm.remoteStream);\t\n      });\n      console.log('bind copy tracks into RTCPeerConnection! ' +desSocketId);\n\n      console.log(\"call createOffer \"+desSocketId);\n      //if(state === 'joined_conn'){\n\n      var offerOptions = {\n        offerToRecieveAudio: 1,\n        offerToRecieveVideo: 1\n      }\n      // var peer = this.pcDesSessionMap.get(desSocketId).peer;\n      // console.log(\"peer createOffer\",peer);\n      peer.createOffer(offerOptions)\n        .then((desc)=>{\n          peer.setLocalDescription(desc);\n          //offer.value = desc.sdp;\n          //offerdesc = desc;\n          //send offer sdp\n          this.sendMessageDes(this.roomId+\"2\",desSocketId, desc);\t\n        \n        })\n        .catch(this.handleOfferError);\n      return;\n    },\n    getRemoteStream(e){\n      console.log(\"ontrack info\",e);\n      this.remoteStream = e.streams[0];\n      this.$refs.remoteVideo.srcObject = this.remoteStream;\n    },\n    getAnswer(desc){\n      console.log(\"createAnswerzzzzzzz\");\n      this.pc.setLocalDescription(desc);\n      //answer.value = desc.sdp;\n      //send answer sdp\n      this.sendMessage(this.roomId,desc);\n    },\n    handleAnswerError(err){\n\t    console.error('Failed to create answer:', err);\n    },\n    handleOfferError(err){\n\t    console.error('Failed to create offer:', err);\n    },\n    sendMessage(roomid,data){\n      if(!this.socket){\n        console.log('socket is null');\n        return;\n      }\n      console.log(\"sendMessage\");\n      var header = {\"roomId\":roomid,\"toSocketId\":this.srcSocketId};\n      console.log('send msg to other end', header, data);\n      this.socket.emit('msg', header, data);\n    },\n    sendMessageDes(roomid,desSocketId,data){\n      console.log('send message to other end', roomid, data);\n      if(!this.socket){\n        console.log('socket is null');\n        return;\n      }\n      this.socket.emit('msg', {\"roomId\":roomid,\"toSocketId\":desSocketId}, data);\n    }\n  }\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped>\nh3 {\n  margin: 40px 0 0;\n}\nul {\n  list-style-type: none;\n  padding: 0;\n}\nli {\n  display: inline-block;\n  margin: 0 10px;\n}\na {\n  color: #42b983;\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RemoteRelayDes.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RemoteRelayDes.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./RemoteRelayDes.vue?vue&type=template&id=0a3be480&scoped=true&\"\nimport script from \"./RemoteRelayDes.vue?vue&type=script&lang=js&\"\nexport * from \"./RemoteRelayDes.vue?vue&type=script&lang=js&\"\nimport style0 from \"./RemoteRelayDes.vue?vue&type=style&index=0&id=0a3be480&prod&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0a3be480\",\n  null\n  \n)\n\nexport default component.exports","<template>\r\n  <div class=\"supervisionList\">\r\n    <div>\r\n      <button id=\"connserver\" @click=\"start\">启动</button>\r\n      <button id=\"leave\" disabled>关闭</button>\t\t\t\t\r\n      socket地址：<input id=\"socketHost\" v-model=\"wsUrl\"/>\r\n      socket房间：<input id=\"roomId\" v-model=\"roomId\"/>\r\n      强制使用中继服务器:<input type=\"checkbox\" id=\"useRelay\" />chrome://webrtc-internals/\r\n    </div>\r\n    <remote-relay-des :wsUrl=\"wsUrl\" :roomId=\"roomId\" ref=\"RemoteRelayDes\"></remote-relay-des>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport RemoteRelayDes from '@/components/webrtc/RemoteRelayDes';\r\n\r\nexport default {\r\n  components: {\r\n    RemoteRelayDes,\r\n  },\r\n  name: 'SupervisionList',\r\n  props: {\r\n    msg: String\r\n  },\r\n  data() {\r\n    return {\r\n      wsUrl: \"wss://localhost:8843\",\r\n      roomId: \"room-multi\",\r\n      pcConfig: {\"iceServers\":[{\"urls\":[\"stun:stun.l.google.com:19302\"]},{\"urls\":[\"turn:rtctest.zdomain.top:3478\"],\"username\":\"admin\",\"credential\":\"123456\"}],\"iceTransportPolicy\":\"all\"},\r\n    };\r\n  },\r\n  mounted:function(){\r\n\r\n  },\r\n  methods: {\r\n    start() {\r\n      var config = {\r\n        wsUrl:this.wsUrl,\r\n        roomId:this.roomId,\r\n        pcConfig:this.pcConfig,\r\n      };\r\n      //console.log(\"start=\",config);\r\n      this.$refs.RemoteRelayDes.start(config);\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n  ","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RelayPage.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RelayPage.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./RelayPage.vue?vue&type=template&id=1d043688&scoped=true&\"\nimport script from \"./RelayPage.vue?vue&type=script&lang=js&\"\nexport * from \"./RelayPage.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1d043688\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RemoteRelayDes.vue?vue&type=style&index=0&id=0a3be480&prod&scoped=true&lang=css&\""],"sourceRoot":""}