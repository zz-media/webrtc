(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-67dca37e"],{"853f":function(e,t,o){},e57b:function(e,t,o){"use strict";o("853f")},e5f6:function(e,t,o){"use strict";o.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"supervisionList"},[t("div",[t("label",[e._v("视频输入设备:")]),t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.videoInputValue,callback:function(t){e.videoInputValue=t},expression:"videoInputValue"}},e._l(e.videoInputOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("label",[e._v("音频输入设备:")]),t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.audioInputValue,callback:function(t){e.audioInputValue=t},expression:"audioInputValue"}},e._l(e.audioInputOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("label",[e._v("音频输出设备:")]),t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.audioOutputValue,callback:function(t){e.audioOutputValue=t},expression:"audioOutputValue"}},e._l(e.audioOutputOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("div",[t("button",{attrs:{id:"connserver"},on:{click:e.start}},[e._v("启动")]),t("button",{attrs:{id:"leave",disabled:""}},[e._v("关闭")]),e._v(" socket地址："),t("input",{directives:[{name:"model",rawName:"v-model",value:e.wsUrl,expression:"wsUrl"}],attrs:{id:"socketHost"},domProps:{value:e.wsUrl},on:{input:function(t){t.target.composing||(e.wsUrl=t.target.value)}}}),e._v(" socket房间："),t("input",{directives:[{name:"model",rawName:"v-model",value:e.roomId,expression:"roomId"}],attrs:{id:"roomId"},domProps:{value:e.roomId},on:{input:function(t){t.target.composing||(e.roomId=t.target.value)}}}),e._v(" 强制使用中继服务器:"),t("input",{attrs:{type:"checkbox",id:"useRelay"}}),e._v("chrome://webrtc-internals/ ")]),t("remote-src",{ref:"RemoteSrc",attrs:{wsUrl:e.wsUrl,roomId:e.roomId}})],1)},i=[],a=(o("14d9"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"hello"},[t("div",{staticClass:"videoDiv"},[t("div",{staticClass:"videoNav"},[e._v(" bytes:"+e._s(e.reportCount.bytes)),t("br"),e._v(" packets:"+e._s(e.reportCount.packets)),t("br"),e._v(" frames:"+e._s(null!=e.reportCount.currentReport?e.reportCount.currentReport.framesPerSecond:0)),t("br"),e._v(" delay:"+e._s(null!=e.reportCount.currentReport?e.reportCount.currentReport.totalSquaredInterFrameDelay:0)+" ")]),t("video",{ref:"localVideo",staticClass:"localVideo",attrs:{autoplay:"",muted:"",playsinline:""},domProps:{muted:!0}})]),t("div",{staticClass:"remoteVideoListDiv"},e._l(e.sessionList,(function(e){return t("div",{key:e.desSocketId,staticClass:"remoteVideoDiv"},[t("video",{ref:"remoteVideo-"+e.desSocketId,refInFor:!0,staticClass:"remoteVideo",attrs:{autoplay:"",playsinline:""}})])})),0)])}),n=[],r=o("8055"),l=o.n(r),d={props:{},data(){return{wsUrl:"wss://localhost:8843",roomId:"room-multi",pcConfig:{iceServers:[{urls:["stun:stun.l.google.com:19302"]},{urls:["turn:rtctest.zdomain.top:3478"],username:"admin",credential:"123456"}],iceTransportPolicy:"all"},socket:null,sessionMap:new Map,sessionMapChangeTag:0,srcSocketId:null,localStream:null,timeInterval:null,reportCount:{lastReport:null,currentReport:null,bytes:0,packets:0}}},computed:{sessionList(){this.sessionMapChangeTag;return Array.from(this.sessionMap.values())}},methods:{start(e){console.log("start",e.localStream),this.localStream=e.localStream,this.$refs.localVideo.srcObject=this.localStream,this.wsUrl=e.wsUrl,this.roomId=e.roomId,this.pcConfig=e.pcConfig,this.socket=l.a.connect(this.wsUrl),console.log(this.socket),this.socket.on("src-joined",(e,t)=>{console.log("receive src-joined message!",e,t)}),this.socket.on("des-join",(e,t)=>{console.log("receive des-join message:",e,t),this.createPeerConnection(t)}),this.socket.on("msg",(e,t)=>{console.log("receive message!",e,t);var o=this.sessionMap.get(e.fromSocketId),s=o.peer;if("string"===typeof t&&(t=JSON.parse(t)),null!==t&&void 0!==t)if("answer"==t.type)s.setRemoteDescription(new RTCSessionDescription(t));else if("candidate"===t.type){var i=new RTCIceCandidate({sdpMLineIndex:t.label,candidate:t.candidate});s.addIceCandidate(i)}else"need_offer"===t.type||("fileinfo"===t.type?console.log("fileinfo",t):console.log("the message is invalid!",t));else console.error("the message is invalid!")}),this.socket.emit("src-join",this.roomId)},createPeerConnection(e){var t=this,o=this.sessionMap.get(e),s=null;if(o?console.warning("the pc have be created!"):(console.log("create new RTCPeerConnection:"+e),s=new RTCPeerConnection(this.pcConfig),this.sessionMap.set(e,{desSocketId:e,peer:s}),this.sessionMapChangeTag++,console.log("RTCPeerConnection nums:"+this.sessionMap.size),s.onicecandidate=t=>{t.candidate?this.sendMessage(this.roomId,e,{type:"candidate",label:t.candidate.sdpMLineIndex,id:t.candidate.sdpMid,candidate:t.candidate.candidate}):console.log("this is the end candidate")},s.ontrack=t=>{this.$refs["remoteVideo-"+e][0].srcObject=t.streams[0]}),console.log("bind tracks into RTCPeerConnection!"),null!==s&&void 0!==s)if(null!==this.localStream&&void 0!==this.localStream){this.localStream.getTracks().forEach(e=>{s.addTrack(e,this.localStream)});var i={offerToRecieveAudio:1,offerToRecieveVideo:1};s.createOffer(i).then(o=>{s.setLocalDescription(o),t.sendMessage(t.roomId,e,o)}).catch(this.handleOfferError)}else console.error("localstream is null or undefined!");else console.error("pc is null or undefined!")},sendMessage(e,t,o){console.log("send message to other end",e,o),this.socket||console.log("socket is null"),this.socket.emit("msg",{roomId:e,toSocketId:t},o)},handleOfferError(e){console.error("Failed to create offer:",e)}}},c=d,u=(o("e57b"),o("2877")),p=Object(u["a"])(c,a,n,!1,null,"a0bc006c",null),v=p.exports,m=o("d3e6"),h={components:{RemoteSrc:v},name:"SupervisionList",props:{msg:String},data(){return{videoInputOptions:[],audioInputOptions:[],audioOutputOptions:[],videoInputValue:null,audioInputValue:null,audioOutputValue:null,wsUrl:"wss://localhost:8843",roomId:"test-multi",pcConfig:{iceServers:[{urls:["stun:stun.l.google.com:19302"]},{urls:["turn:rtctest.zdomain.top:3478"],username:"admin",credential:"123456"}],iceTransportPolicy:"all"}}},mounted:function(){if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){var e={video:!0,audio:!0};navigator.mediaDevices.getUserMedia(e).then(this.gotMediaStreamForTest).then(this.gotDevices).catch(this.handleError),this.wsUrl="wss://"+m["a"].getUrlDomain()+":8843"}else console.log("enumerateDevices is not supported!")},methods:{gotDevices(e){this.videoInputOptions=[],this.audioInputOptions=[],this.audioOutputOptions=[];var t=this;e.forEach((function(e){"audioinput"===e.kind?(t.audioInputOptions.push({value:e.deviceId,label:e.label}),null==t.audioInputValue&&(t.audioInputValue=e.deviceId)):"audiooutput"===e.kind?(t.audioOutputOptions.push({value:e.deviceId,label:e.label}),null==t.audioOutputValue&&(t.audioOutputValue=e.deviceId)):"videoinput"===e.kind&&(t.videoInputOptions.push({value:e.deviceId,label:e.label}),null==t.videoInputValue&&(t.videoInputValue=e.deviceId))}))},gotMediaStreamForTest(e){return navigator.mediaDevices.enumerateDevices()},gotMediaStream(e){console.log("gotMediaStream",e);var t={wsUrl:this.wsUrl,roomId:this.roomId,pcConfig:this.pcConfig,localStream:e};console.log("start=",t),this.$refs.RemoteSrc.start(t)},handleError(e){console.error("Failed:",e)},start(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var e=this.videoInputValue,t={video:{width:640,height:480,frameRate:20,facingMode:"enviroment",deviceId:e?{exact:e}:void 0},audio:!0};navigator.mediaDevices.getUserMedia(t).then(this.gotMediaStream).catch(this.handleError)}else console.log("getUserMedia is not supported!")}}},g=h,f=Object(u["a"])(g,s,i,!1,null,"120de550",null);t["default"]=f.exports}}]);
//# sourceMappingURL=chunk-67dca37e.877495c1.js.map