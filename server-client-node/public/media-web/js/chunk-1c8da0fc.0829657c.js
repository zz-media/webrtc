(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1c8da0fc"],{"7cd5":function(e,o,t){"use strict";t.r(o);var s=function(){var e=this,o=e._self._c;return o("div",{staticClass:"supervisionList"},[o("div",[o("button",{attrs:{id:"connserver"},on:{click:e.start}},[e._v("启动")]),o("button",{attrs:{id:"leave",disabled:""}},[e._v("关闭")]),e._v(" socket地址："),o("input",{directives:[{name:"model",rawName:"v-model",value:e.wsUrl,expression:"wsUrl"}],attrs:{id:"socketHost"},domProps:{value:e.wsUrl},on:{input:function(o){o.target.composing||(e.wsUrl=o.target.value)}}}),e._v(" socket房间："),o("input",{directives:[{name:"model",rawName:"v-model",value:e.roomId,expression:"roomId"}],attrs:{id:"roomId"},domProps:{value:e.roomId},on:{input:function(o){o.target.composing||(e.roomId=o.target.value)}}}),e._v(" 强制使用中继服务器:"),o("input",{attrs:{type:"checkbox",id:"useRelay"}}),e._v("chrome://webrtc-internals/ ")]),o("remote-relay-des",{ref:"RemoteRelayDes",attrs:{wsUrl:e.wsUrl,roomId:e.roomId}})],1)},n=[],i=function(){var e=this,o=e._self._c;return o("div",{staticClass:"hello"},[o("div",[o("span",[e._v("relay画面:")]),o("video",{ref:"remoteVideo",staticStyle:{height:"360px",width:"640px","background-color":"gainsboro","object-fit":"fill"},attrs:{id:"remotevideo",autoplay:"",playsinline:""}})])])},r=[],a=t("8055"),c=t.n(a),d={props:{},data(){return{wsUrl:"wss://localhost:8843",roomId:"room-multi",pcConfig:{iceServers:[{urls:["stun:stun.l.google.com:19302"]},{urls:["turn:rtctest.zdomain.top:3478"],username:"admin",credential:"123456"}],iceTransportPolicy:"all"},socket:null,pc:null,pcDesSessionMap:new Map,srcSocketId:null,remoteStream:null}},methods:{start(e){console.log("start",e),this.wsUrl=e.wsUrl,this.roomId=e.roomId,this.pcConfig=e.pcConfig,this.socket=c.a.connect(this.wsUrl),console.log(this.socket),this.socket.on("des-joined",(e,o)=>{console.log("receive des-joined message!",e,o),this.createPeerConnection()}),this.socket.on("des-join",(e,o)=>{console.log("receive des-join message:",e,o),this.roomId!=e&&this.createPeerConnectionMysrc(o)}),this.socket.on("msg",(e,o)=>{if(console.log("receive message!",e,o),"string"===typeof o&&(o=JSON.parse(o)),null!==o&&void 0!==o){var t=null,s=this.pcDesSessionMap.get(e.fromSocketId);if(null==s?(t=this.pc,this.srcSocketId=e.fromSocketId):t=s.peer,"offer"===o.type)this.pc.setRemoteDescription(new RTCSessionDescription(o)),this.pc.createAnswer().then(this.getAnswer).catch(this.handleAnswerError);else if("answer"==o.type)t.setRemoteDescription(new RTCSessionDescription(o));else if("candidate"===o.type){var n=new RTCIceCandidate({sdpMLineIndex:o.label,candidate:o.candidate});t.addIceCandidate(n)}else console.log("the message is invalid!!!",o)}else console.error("the message is invalid!")}),this.socket.emit("des-join",this.roomId),this.socket.emit("src-join",this.roomId+"2")},createPeerConnection(){console.log("create RTCPeerConnection!"),this.pc=new RTCPeerConnection(this.pcConfig);var e=this.roomId;this.pc.onicecandidate=o=>{o.candidate?this.sendMessage(e,{type:"candidate",label:o.candidate.sdpMLineIndex,id:o.candidate.sdpMid,candidate:o.candidate.candidate}):console.log("this is the end candidate")},this.pc.ontrack=this.getRemoteStream},createPeerConnectionMysrc(e){var o=this;console.log("create RTCPeerConnection! "+e);var t=this.pcDesSessionMap.get(e),s=null;if(t?console.warning("the pc have be created!"):(s=new RTCPeerConnection(this.pcConfig),this.pcDesSessionMap.set(e,{peer:s}),s.onicecandidate=o=>{o.candidate?this.sendMessageDes(this.roomId+"2",e,{type:"candidate",label:o.candidate.sdpMLineIndex,id:o.candidate.sdpMid,candidate:o.candidate.candidate}):console.log("this is the end candidate")}),null!==s&&void 0!==s)if(null!==this.remoteStream&&void 0!==this.remoteStream){this.remoteStream.getTracks().forEach(e=>{s.addTrack(e,o.remoteStream)}),console.log("bind copy tracks into RTCPeerConnection! "+e),console.log("call createOffer "+e);var n={offerToRecieveAudio:1,offerToRecieveVideo:1};s.createOffer(n).then(o=>{s.setLocalDescription(o),this.sendMessageDes(this.roomId+"2",e,o)}).catch(this.handleOfferError)}else console.error("remoteStream is null or undefined!");else console.error("pc is null or undefined!")},getRemoteStream(e){console.log("ontrack info",e),this.remoteStream=e.streams[0],this.$refs.remoteVideo.srcObject=this.remoteStream},getAnswer(e){console.log("createAnswerzzzzzzz"),this.pc.setLocalDescription(e),this.sendMessage(this.roomId,e)},handleAnswerError(e){console.error("Failed to create answer:",e)},handleOfferError(e){console.error("Failed to create offer:",e)},sendMessage(e,o){if(this.socket){console.log("sendMessage");var t={roomId:e,toSocketId:this.srcSocketId};console.log("send msg to other end",t,o),this.socket.emit("msg",t,o)}else console.log("socket is null")},sendMessageDes(e,o,t){console.log("send message to other end",e,t),this.socket?this.socket.emit("msg",{roomId:e,toSocketId:o},t):console.log("socket is null")}}},l=d,m=(t("9aae"),t("2877")),h=Object(m["a"])(l,i,r,!1,null,"0a3be480",null),p=h.exports,u={components:{RemoteRelayDes:p},name:"SupervisionList",props:{msg:String},data(){return{wsUrl:"wss://localhost:8843",roomId:"room-multi",pcConfig:{iceServers:[{urls:["stun:stun.l.google.com:19302"]},{urls:["turn:rtctest.zdomain.top:3478"],username:"admin",credential:"123456"}],iceTransportPolicy:"all"}}},mounted:function(){},methods:{start(){var e={wsUrl:this.wsUrl,roomId:this.roomId,pcConfig:this.pcConfig};this.$refs.RemoteRelayDes.start(e)}}},g=u,f=Object(m["a"])(g,s,n,!1,null,"1d043688",null);o["default"]=f.exports},"97db":function(e,o,t){},"9aae":function(e,o,t){"use strict";t("97db")}}]);
//# sourceMappingURL=chunk-1c8da0fc.0829657c.js.map