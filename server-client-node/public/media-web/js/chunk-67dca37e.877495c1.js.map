{"version":3,"sources":["webpack:///./src/components/webrtc/RemoteSrc.vue?c2b5","webpack:///./src/views/SrcPage.vue","webpack:///./src/components/webrtc/RemoteSrc.vue","webpack:///src/components/webrtc/RemoteSrc.vue","webpack:///./src/components/webrtc/RemoteSrc.vue?6d0c","webpack:///./src/components/webrtc/RemoteSrc.vue?5561","webpack:///src/views/SrcPage.vue","webpack:///./src/views/SrcPage.vue?1cf1","webpack:///./src/views/SrcPage.vue?a235"],"names":["render","_vm","this","_c","_self","staticClass","_v","attrs","model","value","videoInputValue","callback","$$v","expression","_l","videoInputOptions","item","key","label","audioInputValue","audioInputOptions","audioOutputValue","audioOutputOptions","on","start","directives","name","rawName","wsUrl","domProps","$event","target","composing","roomId","ref","staticRenderFns","_s","reportCount","bytes","packets","currentReport","framesPerSecond","totalSquaredInterFrameDelay","sessionList","session","desSocketId","refInFor","props","data","pcConfig","socket","sessionMap","sessionMapChangeTag","srcSocketId","localStream","timeInterval","lastReport","computed","methods","console","peer","sdpMLineIndex","candidate","createPeerConnection","type","id","offerToRecieveAudio","offerToRecieveVideo","then","vm","catch","sendMessage","handleOfferError","component","components","RemoteSrc","msg","mounted","video","audio","navigator","gotDevices","deviceInfos","gotMediaStreamForTest","gotMediaStream","handleError","width","height","frameRate","facingMode","deviceId","exact"],"mappings":"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","file":"js/chunk-67dca37e.877495c1.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RemoteSrc.vue?vue&type=style&index=0&id=a0bc006c&prod&scoped=true&lang=css&\"","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"supervisionList\"},[_c('div',[_c('label',[_vm._v(\"视频输入设备:\")]),_c('el-select',{attrs:{\"placeholder\":\"请选择\"},model:{value:(_vm.videoInputValue),callback:function ($$v) {_vm.videoInputValue=$$v},expression:\"videoInputValue\"}},_vm._l((_vm.videoInputOptions),function(item){return _c('el-option',{key:item.value,attrs:{\"label\":item.label,\"value\":item.value}})}),1),_c('label',[_vm._v(\"音频输入设备:\")]),_c('el-select',{attrs:{\"placeholder\":\"请选择\"},model:{value:(_vm.audioInputValue),callback:function ($$v) {_vm.audioInputValue=$$v},expression:\"audioInputValue\"}},_vm._l((_vm.audioInputOptions),function(item){return _c('el-option',{key:item.value,attrs:{\"label\":item.label,\"value\":item.value}})}),1),_c('label',[_vm._v(\"音频输出设备:\")]),_c('el-select',{attrs:{\"placeholder\":\"请选择\"},model:{value:(_vm.audioOutputValue),callback:function ($$v) {_vm.audioOutputValue=$$v},expression:\"audioOutputValue\"}},_vm._l((_vm.audioOutputOptions),function(item){return _c('el-option',{key:item.value,attrs:{\"label\":item.label,\"value\":item.value}})}),1)],1),_c('div',[_c('button',{attrs:{\"id\":\"connserver\"},on:{\"click\":_vm.start}},[_vm._v(\"启动\")]),_c('button',{attrs:{\"id\":\"leave\",\"disabled\":\"\"}},[_vm._v(\"关闭\")]),_vm._v(\" socket地址：\"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.wsUrl),expression:\"wsUrl\"}],attrs:{\"id\":\"socketHost\"},domProps:{\"value\":(_vm.wsUrl)},on:{\"input\":function($event){if($event.target.composing)return;_vm.wsUrl=$event.target.value}}}),_vm._v(\" socket房间：\"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.roomId),expression:\"roomId\"}],attrs:{\"id\":\"roomId\"},domProps:{\"value\":(_vm.roomId)},on:{\"input\":function($event){if($event.target.composing)return;_vm.roomId=$event.target.value}}}),_vm._v(\" 强制使用中继服务器:\"),_c('input',{attrs:{\"type\":\"checkbox\",\"id\":\"useRelay\"}}),_vm._v(\"chrome://webrtc-internals/ \")]),_c('remote-src',{ref:\"RemoteSrc\",attrs:{\"wsUrl\":_vm.wsUrl,\"roomId\":_vm.roomId}})],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"hello\"},[_c('div',{staticClass:\"videoDiv\"},[_c('div',{staticClass:\"videoNav\"},[_vm._v(\" bytes:\"+_vm._s(_vm.reportCount.bytes)),_c('br'),_vm._v(\" packets:\"+_vm._s(_vm.reportCount.packets)),_c('br'),_vm._v(\" frames:\"+_vm._s(_vm.reportCount.currentReport!=null?_vm.reportCount.currentReport.framesPerSecond:0)),_c('br'),_vm._v(\" delay:\"+_vm._s(_vm.reportCount.currentReport!=null?_vm.reportCount.currentReport.totalSquaredInterFrameDelay:0)+\" \")]),_c('video',{ref:\"localVideo\",staticClass:\"localVideo\",attrs:{\"autoplay\":\"\",\"muted\":\"\",\"playsinline\":\"\"},domProps:{\"muted\":true}})]),_c('div',{staticClass:\"remoteVideoListDiv\"},_vm._l((_vm.sessionList),function(session){return _c('div',{key:session.desSocketId,staticClass:\"remoteVideoDiv\"},[_c('video',{ref:'remoteVideo-'+session.desSocketId,refInFor:true,staticClass:\"remoteVideo\",attrs:{\"autoplay\":\"\",\"playsinline\":\"\"}})])}),0)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"hello\">\n    <div class=\"videoDiv\">\n        <div class=\"videoNav\">\n          bytes:{{reportCount.bytes}}<br/>\n          packets:{{reportCount.packets}}<br/>\n          frames:{{reportCount.currentReport!=null?reportCount.currentReport.framesPerSecond:0}}<br/>\n          delay:{{reportCount.currentReport!=null?reportCount.currentReport.totalSquaredInterFrameDelay:0}}\n        </div>\n        <!-- <video id=\"remote-video\" style=\"max-height:400px;background-color:gainsboro;\"  autoplay></video> -->\n        <!-- <video id=\"remote-video\" style=\"height:840;width:1600;background-color:gainsboro;\"  autoplay></video> -->\n        <video ref=\"localVideo\" class=\"localVideo\" autoplay muted playsinline></video>\n    </div>\n    <div class=\"remoteVideoListDiv\">\n      <div class=\"remoteVideoDiv\" v-for=\"session in sessionList\" :key=\"session.desSocketId\">\n        <video :ref=\"'remoteVideo-'+session.desSocketId\" class=\"remoteVideo\" autoplay playsinline></video>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport io from 'socket.io-client';\n\nexport default {\n  props: {\n\n  },\n  data() {\n    return {\n      wsUrl: \"wss://localhost:8843\",\n      roomId: \"room-multi\",\n      pcConfig: {\"iceServers\":[{\"urls\":[\"stun:stun.l.google.com:19302\"]},{\"urls\":[\"turn:rtctest.zdomain.top:3478\"],\"username\":\"admin\",\"credential\":\"123456\"}],\"iceTransportPolicy\":\"all\"},\n      socket: null,\n      //pc: null,\n      sessionMap: new Map(),\n      sessionMapChangeTag: 0,\n      srcSocketId: null,\n      localStream: null,\n      timeInterval: null,\n\n      reportCount:{\n        lastReport: null,\n        currentReport: null,\n        bytes: 0,\n        packets: 0,\n      }\n    };\n  },\n  computed:{\n    sessionList() {\n      var x = this.sessionMapChangeTag; //监听到参数的变化  并改变map\n      return Array.from(this.sessionMap.values());\n    }    \n  },\n  methods: {\n    start(config) {\n      console.log(\"start\",config.localStream);\n      this.localStream = config.localStream;\n      this.$refs.localVideo.srcObject = this.localStream; \n\n\n      this.wsUrl=config.wsUrl;\n      this.roomId=config.roomId;\n      this.pcConfig=config.pcConfig;\n\n      this.socket = io.connect(this.wsUrl);\n      console.log(this.socket);\n      this.socket.on('src-joined', (roomid, id) => {\n        console.log('receive src-joined message!', roomid, id);\n        \n      });\n      this.socket.on('des-join', (roomid,desDocketId) => {\n        console.log('receive des-join message:', roomid, desDocketId);\n        this.createPeerConnection(desDocketId);\n\n      });     \n\n      this.socket.on('msg', (header, data) => {\n        console.log('receive message!', header, data);\n        var sessionInfo = this.sessionMap.get(header.fromSocketId);\n        var peer = sessionInfo.peer;\n        if(typeof data === 'string'){\n          data = JSON.parse(data);\n        }\n\n        if(data === null || data === undefined){\n          console.error('the message is invalid!');\n          return;\t\n        }\n\n        if(data.type == 'answer'){//data.hasOwnProperty('type') && \n          //answer.value = data.sdp;\n          peer.setRemoteDescription(new RTCSessionDescription(data));\n        \n        }else if (data.type === 'candidate'){\n          var candidate = new RTCIceCandidate({\n            sdpMLineIndex: data.label,\n            candidate: data.candidate\n          });\n          peer.addIceCandidate(candidate);\t\n        \n        }else if (data.type === 'need_offer'){\n          //call2(data.fromSocketId);\n        }else if(data.type === 'fileinfo'){\n          console.log('fileinfo',data);\n          // fileName = data.name;\n          // fileType = data.filetype;\n          // fileSize = data.size;\n          // lastModifyTime = data.lastModify;\t\n          // receiveProgress.max = fileSize;\n        }\n        else{\n          console.log('the message is invalid!', data);\n        \n        }\n      \n      });\n\n      this.socket.emit('src-join', this.roomId);\n    },\n    createPeerConnection(desSocketId){\n      var vm = this;\n      //如果是多人的话，在这里要创建一个新的连接.\n      //新创建好的要放到一个map表中。\n      //key=userid, value=peerconnection\n      \n      var sessionInfo = this.sessionMap.get(desSocketId);\n      var peer = null;\n      if(!sessionInfo){\n        console.log('create new RTCPeerConnection:'+desSocketId);\n        // if(document.querySelector('#useRelay').checked){\n        //   pcConfig.iceTransportPolicy=\"relay\";\n        // }else{\n        //   pcConfig.iceTransportPolicy=\"all\";\n        // }\n        //console.log(\"pcConfig\",pcConfig);\t\t\n        peer = new RTCPeerConnection(this.pcConfig);\n        this.sessionMap.set(desSocketId,{\"desSocketId\":desSocketId,\"peer\":peer});\n        this.sessionMapChangeTag++;\n        console.log('RTCPeerConnection nums:'+this.sessionMap.size);\n        peer.onicecandidate = (e)=>{\n          if(e.candidate) {\n            this.sendMessage(this.roomId,desSocketId, {\n              type: 'candidate',\n              label:e.candidate.sdpMLineIndex, \n              id:e.candidate.sdpMid, \n              candidate: e.candidate.candidate\n            });\n          }else{\n            console.log('this is the end candidate');\n          }\n        };\n        peer.ontrack = (e)=>{\n          // console.log(\"peer.ontrack\",this.$refs['remoteVideo']);\n          // console.log(\"peer.ontrack-2\",this.$refs['remoteVideo-'+desSocketId][0]);\n          //this.$refs['remoteVideo'].srcObject = e.streams[0];\n          this.$refs['remoteVideo-'+desSocketId][0].srcObject = e.streams[0];     \n        };\t\t\n      }else {\n        console.warning('the pc have be created!');\n      }\n\n      console.log('bind tracks into RTCPeerConnection!');\n\n      if(peer === null || peer === undefined) {\n        console.error('pc is null or undefined!');\n        return;\n      }\n\n      if(this.localStream === null || this.localStream === undefined) {\n        console.error('localstream is null or undefined!');\n        return;\n      }\n      //add all track into peer connection\n      this.localStream.getTracks().forEach((track)=>{\n        peer.addTrack(track, this.localStream);\t\n      });\n\n      var offerOptions = {\n        offerToRecieveAudio: 1,\n        offerToRecieveVideo: 1\n      }\n      // var peer = sessionMap.get(desSocketId).peer;\n      // console.log(\"peer createOffer\",peer);\n      peer.createOffer(offerOptions)\n        .then((desc)=>{\n          peer.setLocalDescription(desc);\n          vm.sendMessage(vm.roomId,desSocketId, desc);\t \n        })\n        .catch(this.handleOfferError);\n      \n      return;\t\n    },\n    sendMessage(roomid,desSocketId,data){\n\n      console.log('send message to other end', roomid, data);\n      if(!this.socket){\n        console.log('socket is null');\n      }\n      this.socket.emit('msg', {\"roomId\":roomid,\"toSocketId\":desSocketId}, data);\n    },\n    handleOfferError(err){\n      console.error('Failed to create offer:', err);\n    }\n  }\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped>\n.videoDiv{\n  height:360px;\n  width:640px;  \n}\n.videoNav{\n  text-align: left;\n  font-size: 12px;\n  background: rgba(0, 153, 145, 0.7);\n  position: absolute;\n  z-index: 1000;\n}\n.localVideo{\n  height:360px;\n  width:640px;\n  background-color:gainsboro;\n  object-fit:fill;\n}\n.remoteVideoListDiv{\n  text-align: left;\n}\n.remoteVideoDiv{\n  background: rgba(111, 153, 145, 0.9);\n  width:128px;   \n  height:72px;\n  float: left;\n  margin: 3px;\n}\n.remoteVideo{\n  width:128px;   \n  height:72px;\n  background-color:gainsboro;\n  object-fit:fill;  \n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RemoteSrc.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RemoteSrc.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./RemoteSrc.vue?vue&type=template&id=a0bc006c&scoped=true&\"\nimport script from \"./RemoteSrc.vue?vue&type=script&lang=js&\"\nexport * from \"./RemoteSrc.vue?vue&type=script&lang=js&\"\nimport style0 from \"./RemoteSrc.vue?vue&type=style&index=0&id=a0bc006c&prod&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"a0bc006c\",\n  null\n  \n)\n\nexport default component.exports","<template>\r\n  <div class=\"supervisionList\">\r\n    <div>\r\n      <label>视频输入设备:</label>\r\n      <el-select v-model=\"videoInputValue\" placeholder=\"请选择\">\r\n        <el-option\r\n          v-for=\"item in videoInputOptions\"\r\n          :key=\"item.value\"\r\n          :label=\"item.label\"\r\n          :value=\"item.value\">\r\n        </el-option>\r\n      </el-select>\r\n      <label>音频输入设备:</label>\r\n      <el-select v-model=\"audioInputValue\" placeholder=\"请选择\">\r\n        <el-option\r\n          v-for=\"item in audioInputOptions\"\r\n          :key=\"item.value\"\r\n          :label=\"item.label\"\r\n          :value=\"item.value\">\r\n        </el-option>\r\n      </el-select>\r\n      <label>音频输出设备:</label>\r\n      <el-select v-model=\"audioOutputValue\" placeholder=\"请选择\">\r\n        <el-option\r\n          v-for=\"item in audioOutputOptions\"\r\n          :key=\"item.value\"\r\n          :label=\"item.label\"\r\n          :value=\"item.value\">\r\n        </el-option>\r\n      </el-select>\r\n    </div>\r\n    <div>\r\n      <button id=\"connserver\" @click=\"start\">启动</button>\r\n      <button id=\"leave\" disabled>关闭</button>\t\t\t\t\r\n      socket地址：<input id=\"socketHost\" v-model=\"wsUrl\"/>\r\n      socket房间：<input id=\"roomId\" v-model=\"roomId\"/>\r\n      强制使用中继服务器:<input type=\"checkbox\" id=\"useRelay\" />chrome://webrtc-internals/\r\n    </div>\r\n    <remote-src :wsUrl=\"wsUrl\" :roomId=\"roomId\" ref=\"RemoteSrc\"></remote-src>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport RemoteSrc from '@/components/webrtc/RemoteSrc';\r\nimport urlUtil from '@/utils/urlUtil.js'\r\n\r\nexport default {\r\n  components: {\r\n    RemoteSrc,\r\n  },\r\n  name: 'SupervisionList',\r\n  props: {\r\n    msg: String\r\n  },\r\n  data() {\r\n    return {\r\n      videoInputOptions: [],\r\n      audioInputOptions: [],\r\n      audioOutputOptions: [],\r\n      videoInputValue: null,\r\n      audioInputValue: null,\r\n      audioOutputValue: null,\r\n      wsUrl: \"wss://localhost:8843\",\r\n      roomId: \"test-multi\",\r\n      pcConfig: {\"iceServers\":[{\"urls\":[\"stun:stun.l.google.com:19302\"]},{\"urls\":[\"turn:rtctest.zdomain.top:3478\"],\"username\":\"admin\",\"credential\":\"123456\"}],\"iceTransportPolicy\":\"all\"},\r\n    };\r\n  },\r\n  mounted:function(){\r\n    if(!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices){\r\n      console.log('enumerateDevices is not supported!');\r\n      return;\r\n    }\r\n    var constraints = {\r\n      video : true, \r\n      audio : true \r\n    };\r\n    navigator.mediaDevices.getUserMedia(constraints)\r\n      .then(this.gotMediaStreamForTest)\r\n      .then(this.gotDevices)\r\n      .catch(this.handleError);\r\n  \r\n    this.wsUrl = \"wss://\"+urlUtil.getUrlDomain()+\":8843\";\r\n  },\r\n  methods: {\r\n    gotDevices(deviceInfos){\r\n      //console.log(\"deviceInfos\",deviceInfos);\r\n      this.videoInputOptions = [];\r\n      this.audioInputOptions = [];\r\n      this.audioOutputOptions = [];\r\n      var vm = this;\r\n      deviceInfos.forEach(function(deviceInfo){\r\n        //console.log(deviceInfo.kind + \": label = \" + deviceInfo.label + \": id = \" + deviceInfo.deviceId + \": groupId = \" + deviceInfo.groupId);\t\r\n        if(deviceInfo.kind === 'audioinput'){\r\n          vm.audioInputOptions.push({\"value\":deviceInfo.deviceId,\"label\":deviceInfo.label});\r\n          if(vm.audioInputValue == null){\r\n            vm.audioInputValue = deviceInfo.deviceId;\r\n          }\r\n        }else if(deviceInfo.kind === 'audiooutput'){\r\n          vm.audioOutputOptions.push({\"value\":deviceInfo.deviceId,\"label\":deviceInfo.label});\r\n          if(vm.audioOutputValue == null){\r\n            vm.audioOutputValue = deviceInfo.deviceId;\r\n          }\r\n        }else if(deviceInfo.kind === 'videoinput'){\r\n          vm.videoInputOptions.push({\"value\":deviceInfo.deviceId,\"label\":deviceInfo.label});\r\n          if(vm.videoInputValue == null){\r\n            vm.videoInputValue = deviceInfo.deviceId;\r\n          }\r\n        }\r\n      });\r\n\r\n    },\r\n    gotMediaStreamForTest(stream){\r\n      return navigator.mediaDevices.enumerateDevices();\r\n    },\r\n    gotMediaStream(stream){\r\n      console.log(\"gotMediaStream\",stream);\r\n      // var videoTrack = stream.getVideoTracks()[0];\r\n      // var videoConstraints = videoTrack.getSettings();\r\n      \r\n      // divConstraints.textContent = JSON.stringify(videoConstraints, null, 2);\r\n\r\n      // window.stream = stream;\r\n      // videoplay.srcObject = stream;\r\n\r\n      var config = {\r\n        wsUrl: this.wsUrl,\r\n        roomId: this.roomId,\r\n        pcConfig: this.pcConfig,\r\n        localStream: stream,\r\n      };\r\n      console.log(\"start=\",config);\r\n      this.$refs.RemoteSrc.start(config);\r\n\r\n      //return navigator.mediaDevices.enumerateDevices();\r\n    },\r\n    handleError(err){\r\n\t    console.error('Failed:', err);\r\n    },\r\n    start() {\r\n      if(!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia){\r\n        console.log('getUserMedia is not supported!');\r\n        return;\r\n      }\r\n      //navigator.mediaDevices.getUserMedia({audio: true, video: false});\r\n      var deviceId = this.videoInputValue; \r\n      var constraints = {\r\n        video : {\r\n          width: 640,\t\r\n          height: 480,\r\n          frameRate:20,\r\n          facingMode: 'enviroment',\r\n          deviceId : deviceId ? {exact:deviceId} : undefined \r\n        }, \r\n        audio : true \r\n      }\r\n\r\n      navigator.mediaDevices.getUserMedia(constraints)\r\n        .then(this.gotMediaStream)\r\n        //.then(this.gotDevices)\r\n        .catch(this.handleError);\r\n    \r\n      },\r\n\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n  ","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SrcPage.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SrcPage.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./SrcPage.vue?vue&type=template&id=120de550&scoped=true&\"\nimport script from \"./SrcPage.vue?vue&type=script&lang=js&\"\nexport * from \"./SrcPage.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"120de550\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}