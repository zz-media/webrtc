(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7cce3027"],{"0d48":function(e,t,o){"use strict";o.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"supervisionList"},[t("div",[t("label",[e._v("视频输入设备:")]),t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.videoInputValue,callback:function(t){e.videoInputValue=t},expression:"videoInputValue"}},e._l(e.videoInputOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("label",[e._v("音频输入设备:")]),t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.audioInputValue,callback:function(t){e.audioInputValue=t},expression:"audioInputValue"}},e._l(e.audioInputOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("label",[e._v("音频输出设备:")]),t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.audioOutputValue,callback:function(t){e.audioOutputValue=t},expression:"audioOutputValue"}},e._l(e.audioOutputOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("div",[t("el-checkbox",{model:{value:e.localMediaChecked,callback:function(t){e.localMediaChecked=t},expression:"localMediaChecked"}},[e._v("传输本地媒体")]),t("label",[e._v("额外终端连接:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.moreDesCount,expression:"moreDesCount"}],attrs:{placeholder:"额外终端连接"},domProps:{value:e.moreDesCount},on:{input:function(t){t.target.composing||(e.moreDesCount=t.target.value)}}}),t("button",{attrs:{id:"connserver"},on:{click:e.start}},[e._v("启动")]),t("button",{attrs:{id:"leave",disabled:""}},[e._v("关闭")]),e._v(" socket地址："),t("input",{directives:[{name:"model",rawName:"v-model",value:e.wsUrl,expression:"wsUrl"}],attrs:{id:"socketHost"},domProps:{value:e.wsUrl},on:{input:function(t){t.target.composing||(e.wsUrl=t.target.value)}}}),e._v(" socket房间："),t("input",{directives:[{name:"model",rawName:"v-model",value:e.roomId,expression:"roomId"}],attrs:{id:"roomId"},domProps:{value:e.roomId},on:{input:function(t){t.target.composing||(e.roomId=t.target.value)}}}),e._v(" 强制使用中继服务器:"),t("input",{attrs:{type:"checkbox",id:"useRelay"}}),e._v("chrome://webrtc-internals/ ")],1),t("remote-des",{ref:"RemoteDes"}),e._l(9,(function(o){return t("div",{directives:[{name:"show",rawName:"v-show",value:o<=e.moreDesCount,expression:"moreDes<=moreDesCount"}],key:o},[e._v(" RemoteDes"+e._s(o)+" "),t("remote-des",{ref:"RemoteDes-"+o,refInFor:!0})],1)}))],2)},r=[],a=(o("14d9"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"hello"},[t("div",{staticClass:"videoDiv"},[t("div",{staticClass:"videoNav"},[e._v(" decoderImp:"+e._s(null!=e.reportCount.currentReport?e.reportCount.currentReport.decoderImplementation:"")),t("br"),e._v(" bytes:"+e._s(e.reportCount.bytes)),t("br"),e._v(" packets:"+e._s(e.reportCount.packets)),t("br"),e._v(" packetsLost:"+e._s(null!=e.reportCount.currentReport?e.reportCount.currentReport.packetsLost:0)),t("br"),e._v(" frameSize:"+e._s(null!=e.reportCount.currentReport?e.reportCount.currentReport.frameWidth:0)+" "+e._s(null!=e.reportCount.currentReport?e.reportCount.currentReport.frameHeight:0)),t("br"),e._v(" frames:"+e._s(null!=e.reportCount.currentReport?e.reportCount.currentReport.framesPerSecond:0)),t("br"),e._v(" audioOpen:"+e._s(e.reportCount.audioOpen)),t("br")]),t("div",{directives:[{name:"show",rawName:"v-show",value:null!=e.localStream,expression:"localStream!=null"}],staticClass:"localVideoDiv"},[t("video",{ref:"localVideo",staticClass:"localVideo",attrs:{autoplay:"",muted:"",playsinline:""},domProps:{muted:!0}})]),t("video",{ref:"remoteVideo",staticClass:"remoteVideo",attrs:{autoplay:"",playsinline:""}})])])}),i=[],n=o("8055"),l=o.n(n),c={props:{},data(){return{wsUrl:"wss://localhost:8843",roomId:"room-multi",pcConfig:{iceServers:[{urls:["stun:stun.l.google.com:19302"]},{urls:["turn:rtctest.zdomain.top:3478"],username:"admin",credential:"123456"}],iceTransportPolicy:"all"},socket:null,pc:null,srcSocketId:null,remoteStream:null,localStream:null,timeInterval:null,reportCount:{lastReport:null,currentReport:null,bytes:0,packets:0,audioOpen:!1}}},methods:{start(e){console.log("start",e),this.wsUrl=e.wsUrl,this.roomId=e.roomId,this.pcConfig=e.pcConfig,this.localStream=e.localStream,null!=this.localStream&&(this.$refs.localVideo.srcObject=this.localStream),console.log("wss连接"+this.wsUrl),this.socket=l.a.connect(this.wsUrl),console.log(this.socket),this.socket.on("des-joined",(e,t)=>{console.log("receive des-joined message!",e,t),this.createPeerConnection()}),this.socket.on("msg",(e,t)=>{if(console.log("receive message:",e,t),this.srcSocketId=e.fromSocketId,"string"===typeof t&&(t=JSON.parse(t)),null!==t&&void 0!==t)if("offer"===t.type)this.pc.setRemoteDescription(new RTCSessionDescription(t)),this.pc.createAnswer().then(this.getAnswer).catch(this.handleAnswerError);else if("candidate"===t.type){var o=new RTCIceCandidate({sdpMLineIndex:t.label,candidate:t.candidate});this.pc.addIceCandidate(o)}else console.log("the message is invalid!!!",t);else console.error("the message is invalid!")}),this.socket.emit("des-join",this.roomId),this.startInterval()},startInterval(){this.timeInterval=setInterval(()=>{if(this.pc){for(var e=null,t=0;t<this.pc.getReceivers().length;t++)"video"==this.pc.getReceivers()[t].track.kind?e=this.pc.getReceivers()[t]:"audio"==this.pc.getReceivers()[t].track.kind&&(this.reportCount.audioOpen=!0);e&&e.getStats().then(e=>{e.forEach(e=>{if("inbound-rtp"===e.type){if(console.log("report",e),e.isRemote)return;this.reportCount.currentReport=e,this.reportCount.lastReport&&this.reportCount.currentReport&&(this.reportCount.bytes=this.reportCount.currentReport.bytesReceived-this.reportCount.lastReport.bytesReceived,this.reportCount.packets=this.reportCount.currentReport.packetsReceived-this.reportCount.lastReport.packetsReceived),this.reportCount.lastReport=e}})})}},1e3)},stop(){},createPeerConnection(){console.log("create RTCPeerConnection!"),this.pc=new RTCPeerConnection(this.pcConfig),this.pc.onicecandidate=e=>{e.candidate?this.sendMessage(this.roomId,{type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate}):console.log("this is the end candidate")},this.pc.ontrack=e=>{console.log("ontrack info",e),this.remoteStream=e.streams[0],this.$refs.remoteVideo.srcObject=this.remoteStream},null===this.localStream||void 0===this.localStream?console.error("localstream is null or undefined!"):this.localStream.getTracks().forEach(e=>{this.pc.addTrack(e,this.localStream)})},getAnswer(e){console.log("getAnswer:",e),console.log("getAnswer sdp:",e.sdp),this.pc.setLocalDescription(e),this.sendMessage(this.roomId,e)},handleAnswerError(e){console.error("Failed to create answer:",e)},sendMessage(e,t){if(this.socket){var o={roomId:e,toSocketId:this.srcSocketId};console.log("send  message:",o,t),this.socket.emit("msg",o,t)}else console.error("sendMessage socket is null")}}},u=c,d=(o("1600"),o("2877")),p=Object(d["a"])(u,a,i,!1,null,"90673a32",null),m=p.exports,v=o("d3e6"),h={components:{RemoteDes:m},name:"SupervisionList",props:{msg:String},data(){return{videoInputOptions:[],audioInputOptions:[],audioOutputOptions:[],videoInputValue:null,audioInputValue:null,audioOutputValue:null,localStream:null,localMediaChecked:!1,moreDesCount:0,wsUrl:"wss://"+v["a"].getUrlDomain()+":8843",roomId:"room-multi",pcConfig:{iceServers:[{urls:["stun:stun.l.google.com:19302"]},{urls:["turn:rtctest.zdomain.top:3478"],username:"admin",credential:"123456"}],iceTransportPolicy:"all"}}},mounted:function(){if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){var e={video:!0,audio:!0};navigator.mediaDevices.getUserMedia(e).then(this.gotMediaStream).then(this.gotDevices).catch(this.handleError)}else console.log("enumerateDevices is not supported!")},methods:{start(){var e={wsUrl:this.wsUrl,roomId:this.roomId,pcConfig:this.pcConfig,localStream:this.localMediaChecked?this.localStream:null};console.log("start=",e),this.$refs.RemoteDes.start(e);for(var t=1;t<=this.moreDesCount;t++)this.$refs["RemoteDes-"+t][0].start(e)},gotDevices(e){this.videoInputOptions=[],this.audioInputOptions=[],this.audioOutputOptions=[];var t=this;e.forEach((function(e){"audioinput"===e.kind?(t.audioInputOptions.push({value:e.deviceId,label:e.label}),null==t.audioInputValue&&(t.audioInputValue=e.deviceId)):"audiooutput"===e.kind?(t.audioOutputOptions.push({value:e.deviceId,label:e.label}),null==t.audioOutputValue&&(t.audioOutputValue=e.deviceId)):"videoinput"===e.kind&&(t.videoInputOptions.push({value:e.deviceId,label:e.label}),null==t.videoInputValue&&(t.videoInputValue=e.deviceId))}))},gotMediaStream(e){return console.log("gotMediaStream",e),this.localStream=e,navigator.mediaDevices.enumerateDevices()},handleError(e){console.error("Failed:",e)}}},g=h,f=Object(d["a"])(g,s,r,!1,null,"e2f5ba4c",null);t["default"]=f.exports},1600:function(e,t,o){"use strict";o("8377")},8377:function(e,t,o){}}]);
//# sourceMappingURL=chunk-7cce3027.513b594a.js.map